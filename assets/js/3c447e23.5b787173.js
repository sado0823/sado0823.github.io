"use strict";(self.webpackChunkgo_kitx_webside=self.webpackChunkgo_kitx_webside||[]).push([[7433],{3905:function(e,n,r){r.d(n,{Zo:function(){return p},kt:function(){return m}});var t=r(7294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=t.createContext({}),s=function(e){var n=t.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},p=function(e){var n=s(e.components);return t.createElement(i.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=s(r),m=o,k=u["".concat(i,".").concat(m)]||u[m]||d[m]||a;return r?t.createElement(k,l(l({ref:n},p),{},{components:r})):t.createElement(k,l({ref:n},p))}));function m(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=u;var c={};for(var i in n)hasOwnProperty.call(n,i)&&(c[i]=n[i]);c.originalType=e,c.mdxType="string"==typeof e?e:o,l[1]=c;for(var s=2;s<a;s++)l[s]=r[s];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}u.displayName="MDXCreateElement"},9677:function(e,n,r){r.r(n),r.d(n,{assets:function(){return p},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return d}});var t=r(7462),o=r(3366),a=(r(7294),r(3905)),l=["components"],c={slug:"docker-and-compose",title:"Docker And Docker-Compose",authors:["sado"],tags:["golang","docker","docker-compose"],date:"2022-05-24T18:50"},i=void 0,s={permalink:"/blog/docker-and-compose",source:"@site/blog/2022-05-24-docker-and-compose.md",title:"Docker And Docker-Compose",description:"1\u3001why docker ?",date:"2022-05-24T18:50:00.000Z",formattedDate:"May 24, 2022",tags:[{label:"golang",permalink:"/blog/tags/golang"},{label:"docker",permalink:"/blog/tags/docker"},{label:"docker-compose",permalink:"/blog/tags/docker-compose"}],readingTime:4.145,truncated:!0,authors:[{name:"sado",title:"Developer",url:"https://github.com/sado0823",imageURL:"/img/avatar.jpeg",key:"sado"}],frontMatter:{slug:"docker-and-compose",title:"Docker And Docker-Compose",authors:["sado"],tags:["golang","docker","docker-compose"],date:"2022-05-24T18:50"},nextItem:{title:"Opentrace Demo",permalink:"/blog/opentrace-demo"}},p={authorsImageUrls:[void 0]},d=[{value:"1\u3001why docker ?",id:"1why-docker-",level:2},{value:"2\u3001about",id:"2about",level:2},{value:"3\u3001how to use ?",id:"3how-to-use-",level:2},{value:"1) command",id:"1-command",level:3},{value:"2) example",id:"2-example",level:3},{value:"3) dockerfile",id:"3-dockerfile",level:3},{value:"4) cluster example",id:"4-cluster-example",level:3},{value:"4\u3001docker-compose",id:"4docker-compose",level:2},{value:"1) config yml",id:"1-config-yml",level:3},{value:"2) scale",id:"2-scale",level:3},{value:"3) command",id:"3-command",level:3},{value:"4) cluster",id:"4-cluster",level:3}],u={toc:d};function m(e){var n=e.components,c=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,t.Z)({},u,c,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"1why-docker-"},"1\u3001why docker ?"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200913225025739",src:r(9191).Z,width:"2600",height:"1172"})),(0,a.kt)("h2",{id:"2about"},"2\u3001about"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"repository"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"image"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"container"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"tag")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200913230214621",src:r(5362).Z,width:"1302",height:"1044"})),(0,a.kt)("h2",{id:"3how-to-use-"},"3\u3001how to use ?"),(0,a.kt)("h3",{id:"1-command"},"1) command"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u4ee5\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u542f\u52a8Docker\nsudo service docker start\n\n# \u8bbe\u7f6e\u5f00\u673a\u81ea\u52a8\u542f\u52a8Docker\nsystemctl start docker\n\n# \u67e5\u770b\u7248\u672c\ndocker version\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u62c9\u53d6\u955c\u50cf \ndocker pull name:tag\ndocker pull nginx\ndocker pull busybox\ndocker pull python:2.7\n\n# \u67e5\u770b\u955c\u50cf\ndocker images\n\n# \u5220\u9664\u955c\u50cf\ndocker rmi id\n\n# \u67e5\u770b\u5bb9\u5668 \u8fd0\u884c\u4e2d\ndocker ps\n\ndocker ps -a \n\n# \u67e5\u770b\u7f51\u7edc (namespace,veth pair)\ndocker network ls\n{ bridge, host, none, overlay}\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# docker run \u542f\u52a8\u5bb9\u5668\n-d \u540e\u53f0\u8fd0\u884c\n--name \u6307\u5b9a\u5bb9\u5668\u540d\u79f0\n-p 80:80 \u7aef\u53e3\u6620\u5c04\n-v /root:/root \u76ee\u5f55\u6620\u5c04\n--link \u94fe\u63a5\u5bb9\u5668\n--nwtwork \u6307\u5b9a\u7f51\u7edc\n-c \u6dfb\u52a0\u8fd0\u884c\u65f6cmd \u547d\u4ee4\n-e \u6dfb\u52a0\u73af\u5883\u53d8\u91cf\n \n# docker exec name -it \n-it \u4ea4\u4e92\u6a21\u5f0f\u8fdb\u5165\u5bb9\u5668\n-i --interactive\n-t --tty    \n\n")),(0,a.kt)("h3",{id:"2-example"},"2) example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-linux"},"-- \u542f\u52a8nginx\u5bb9\u5668\ndocker run -it --name web-n1 -p 80:80 -v /var/www/html:/usr/share/nginx/html -d nginx:alpine\n")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200913233850606",src:r(2152).Z,width:"1086",height:"194"})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"-- \u542f\u52a8redis\ndocker run -d --name rds -p 6379:6379 redis\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"-- \u94fe\u63a5\u5bb9\u5668\ndocker run -d --link rds --name app-1 -e REDIS_HOST=rds app:1.0\n")),(0,a.kt)("h3",{id:"3-dockerfile"},"3) dockerfile"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},"dokcerfile\u6784\u5efa:\n\ufffcFROM  : \u6765\u6e90\u57fa\u7840\u955c\u50cf (scratch -> \u6240\u6709\u955c\u50cf\u539f\u59cb\u955c\u50cf)\n\ufffcMAINTAINER :  \u4f5c\u8005<\u90ae\u7bb1>\n\ufffcRUN : \u5bb9\u5668\u6784\u5efa\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4 (\u521b\u5efa\u7528\u6237\u7ec4 , \u521b\u5efa\u6587\u4ef6\u5939 , \u5b89\u88c5\u5305 \u7b49)\nRUN yum -y install vim \nRUN yum -y install net-tools\nRUN mkdir /var/wwwroot \n\u5efa\u8bae\u5982\u4e0b\u4f7f\u7528 , \u4f7f\u7528 & \u8fde\u63a5 : \nRUN yum -y install vim \\\n&& yum -y install net-tools \\\n&& mkdir /var/wwwroot \n\n\ufffcEXPOSE : \u66b4\u9732\u7684\u7aef\u53e3\u53f7\n\ufffcWORKDIR : \u6307\u5b9a\u5728\u521b\u5efa\u5e76\u4e14\u8fdb\u53bb\u5bb9\u5668\u7ec8\u7aef\u540e\u7684\u5de5\u4f5c\u76ee\u5f55(\u65e0\u6307\u5b9a\u5230 / \u6839\u76ee\u5f55)\n\ufffcENV : \u6784\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf \nENV MY_PATH /var/wwwroot\nWORKDIR $MY_PATH\n\n\ufffcADD : \u5c06\u5bbf\u4e3b\u673a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u62f7\u8d1d\u8fdb\u955c\u50cf , \u5e76\u4e14\u4f1a\u81ea\u52a8\u5904\u7406url\u548c\u89e3\u538btar\u538b\u7f29\u5305\n\ufffcCOPY : \u7c7b\u4f3cadd , \u62f7\u8d1d\u5230\u955c\u50cf, \u6ca1\u6709\u5904\u7406\u529f\u80fd\n\ufffcVALUME : \u5bb9\u5668\u6570\u636e\u5377, \u7528\u4e8e\u6570\u636e\u6301\u4e45\u5316 , \u5bb9\u5668\u4e2d\u521b\u5efa\u6307\u5b9a\u7684\u76ee\u5f55\n\ufffcCMD : \u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u65f6\u8fd0\u884c\u7684\u547d\u4ee4 ( \u591a\u4e2a\u547d\u4ee4\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u751f\u6548 , \u4f1a\u88abdocker run\u4e4b\u540e\u7684\u53c2\u6570\u8986\u76d6)\n\ufffcENTRYPOINT : \u4e0ecmd\u529f\u80fd\u4e00\u6837 , \u4f1a\u5728docker run\u4e4b\u540e\u7684\u53c2\u6570\u8ffd\u52a0\u547d\u4ee4\n\ufffcONBUILD : \u5f53\u6784\u5efa\u4e00\u4e2a\u88ab\u7ee7\u627f\u7684dockerfile\u65f6\u8fd0\u884c\u547d\u4ee4,\u7236\u955c\u50cf\u5728\u88ab\u5b50\u955c\u50cf\u7ee7\u627f\u540e\u7236\u955c\u50cf\u7684onbuild\u88ab\u89e6\u53d1\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM python:3.7\n\nCOPY . /var/www/app\nWORKDIR /var/www/app\nRUN pip install flask redis\nEXPOSE 80\nCMD [ "python","app.py" ]\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from flask import Flask\nfrom redis import Redis\nimport os\nimport socket\n\napp = Flask(__name__)\n\nredis = Redis(host=os.environ.get('REDIS_HOST','127.0.0.1'),prot=6379)\n\n@app.route(\"/\")\ndef incr():\n  redis.incr('like')\n  return 'current like = %s, current host = %s \\n' % (redis.get('like'),socket.gethostname())\n\nif __name__ == \"__main__\":\n  app.run(host=\"0.0.0.0\",port=80,debug=True)\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u4f7f\u7528dockerfile\u6784\u5efa\u955c\u50cf\ndocker build -t name:tag -f template .\ndocker build -t app-1:1.0 .\n\n# \u8fd0\u884c\u6784\u5efa\u955c\u50cf\ndocker run -d --link rds-1 --name app-5 -p 80:80 -e REDIS_HOST=rds-1 app-1:3.0\n\n# \u8fdb\u5165\u5bb9\u5668\ndocker exec -it app-5 bash\ncurl 0.0.0.0:80\n--\x3e current like = b'1', current host = bc33562a73ea\n--\x3e current like = b'2', current host = bc33562a73ea\n--\x3e current like = b'3', current host = bc33562a73ea\n\n\n\n")),(0,a.kt)("h3",{id:"4-cluster-example"},"4) cluster example"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"etcd + docker")),(0,a.kt)("p",null," ",(0,a.kt)("inlineCode",{parentName:"p"},"overlay network")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"/usr/bin/dockerd -H tcp://0.0.0.02375 -H unix:///var/run/docker.sock --cluster-store=etcd://192.168.xxx.xx:2379 --cluster-advertise=192.168.xxx.xx1:2375&\n\n/usr/bin/dockerd -H tcp://0.0.0.02375 -H unix:///var/run/docker.sock --cluster-store=etcd://192.168.xxx.xx:2379 --cluster-advertise=192.168.xxx.xx2:2375&\n")),(0,a.kt)("h2",{id:"4docker-compose"},"4\u3001docker-compose"),(0,a.kt)("h3",{id:"1-config-yml"},"1) config yml"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-docker-compose"},'version: "3"\n\nservices: \n  rds:\n    image: redis\n  app:\n    build: \n      context: .\n      dockerfile: Dockerfile\n      ports: \n        - 80:80\n        environment: \n          REDIS_HOST: rds\n          \n\n')),(0,a.kt)("h3",{id:"2-scale"},"2) scale"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"--scale")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose up --scale app=3 -d")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-docker-compose"},"version: '3'\n\nservices:\n  rds:\n    image: redis\n\n  app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    # ports:\n    # - 80:80\n    environment:\n      REDIS_HOST: rds\n\n  lib:\n    image: dockercloud/haproxy\n    links:\n      - app\n    ports:\n      - 80:80\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n\n")),(0,a.kt)("h3",{id:"3-command"},"3) command"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"cd ~/path\ndocker-compose up -d\ndocker-compose stop\ndocker-compose restart\ndocker-compose down\ndocker-compose build\n\n")),(0,a.kt)("h3",{id:"4-cluster"},"4) cluster"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"k8s, swarm\n")))}m.isMDXComponent=!0},9191:function(e,n,r){n.Z=r.p+"assets/images/image-20200913225025739-cc1be9155dae0ad44f9f247f353d5d2f.png"},5362:function(e,n,r){n.Z=r.p+"assets/images/image-20200913230214621-8dfa2df56f7e05fdc755112e3264fb6e.png"},2152:function(e,n,r){n.Z=r.p+"assets/images/image-20200913233850606-164e3ef62e382a78763ce05f3a39b082.png"}}]);