"use strict";(self.webpackChunkgo_kitx_webside=self.webpackChunkgo_kitx_webside||[]).push([[7977],{3905:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return u}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=r.createContext({}),c=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=c(e.components);return r.createElement(i.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},k=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),k=c(t),u=o,m=k["".concat(i,".").concat(u)]||k[u]||d[u]||a;return t?r.createElement(m,l(l({ref:n},s),{},{components:t})):r.createElement(m,l({ref:n},s))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,l=new Array(a);l[0]=k;var p={};for(var i in n)hasOwnProperty.call(n,i)&&(p[i]=n[i]);p.originalType=e,p.mdxType="string"==typeof e?e:o,l[1]=p;for(var c=2;c<a;c++)l[c]=t[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}k.displayName="MDXCreateElement"},7797:function(e,n,t){t.r(n),t.d(n,{assets:function(){return s},contentTitle:function(){return i},default:function(){return u},frontMatter:function(){return p},metadata:function(){return c},toc:function(){return d}});var r=t(7462),o=t(3366),a=(t(7294),t(3905)),l=["components"],p={slug:"docker-laradock",title:"\u57fa\u4e8eDocker\u5feb\u901f\u642d\u5efanginx+...",authors:["sado"],tags:["redis","docker","docker-compose","mysql","php","nginx"],date:"2021-05-24T18:51"},i=void 0,c={permalink:"/blog/docker-laradock",source:"@site/blog/docker-and-compose/2021-05-24-laradock.md",title:"\u57fa\u4e8eDocker\u5feb\u901f\u642d\u5efanginx+...",description:"\u57fa\u4e8eDocker\u5feb\u901f\u642d\u5efanginx+redis+mysql+php",date:"2021-05-24T18:51:00.000Z",formattedDate:"May 24, 2021",tags:[{label:"redis",permalink:"/blog/tags/redis"},{label:"docker",permalink:"/blog/tags/docker"},{label:"docker-compose",permalink:"/blog/tags/docker-compose"},{label:"mysql",permalink:"/blog/tags/mysql"},{label:"php",permalink:"/blog/tags/php"},{label:"nginx",permalink:"/blog/tags/nginx"}],readingTime:4.815,truncated:!0,authors:[{name:"sado",title:"Developer",url:"https://github.com/sado0823",imageURL:"/img/avatar.jpeg",key:"sado"}],frontMatter:{slug:"docker-laradock",title:"\u57fa\u4e8eDocker\u5feb\u901f\u642d\u5efanginx+...",authors:["sado"],tags:["redis","docker","docker-compose","mysql","php","nginx"],date:"2021-05-24T18:51"},prevItem:{title:"Redis - \u5165\u95e8",permalink:"/blog/redis-introduction"},nextItem:{title:"Docker And Docker-Compose",permalink:"/blog/docker-and-compose"}},s={authorsImageUrls:[void 0]},d=[{value:"1.\u5b98\u7f51\u5730\u5740",id:"1\u5b98\u7f51\u5730\u5740",level:2},{value:"2.\u5b89\u88c5\u51c6\u5907",id:"2\u5b89\u88c5\u51c6\u5907",level:2},{value:"3.\u76ee\u5f55\u7ed3\u6784",id:"3\u76ee\u5f55\u7ed3\u6784",level:2},{value:"4.\u5b89\u88c5",id:"4\u5b89\u88c5",level:2},{value:"5.\u914d\u7f6e",id:"5\u914d\u7f6e",level:2},{value:"1.\u521b\u5efa\u914d\u7f6e\u6587\u4ef6",id:"1\u521b\u5efa\u914d\u7f6e\u6587\u4ef6",level:3},{value:"2.\u914d\u7f6e\u73af\u5883\u9009\u9879",id:"2\u914d\u7f6e\u73af\u5883\u9009\u9879",level:3},{value:"3.\u914d\u7f6edocker-sync(\u53ef\u9009)",id:"3\u914d\u7f6edocker-sync\u53ef\u9009",level:3},{value:"6.\u542f\u52a8",id:"6\u542f\u52a8",level:2},{value:"7.\u5e38\u7528\u6307\u4ee4",id:"7\u5e38\u7528\u6307\u4ee4",level:2},{value:"8.\u914d\u7f6enginx\u8bbf\u95ee\u670d\u52a1",id:"8\u914d\u7f6enginx\u8bbf\u95ee\u670d\u52a1",level:2},{value:"9.\u7ed3\u675f\u8bed",id:"9\u7ed3\u675f\u8bed",level:2}],k={toc:d};function u(e){var n=e.components,p=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},k,p,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\u57fa\u4e8eDocker\u5feb\u901f\u642d\u5efanginx+redis+mysql+php"),(0,a.kt)("h1",{id:"laradock"},"Laradock"),(0,a.kt)("h2",{id:"1\u5b98\u7f51\u5730\u5740"},"1.\u5b98\u7f51\u5730\u5740"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"}," # laradock \u82f1\u6587\u5730\u5740\n https://laradock.io/\n \n # laradock \u4e2d\u6587\u6587\u6863\n https://laradock-docs.linganmin.cn/zh/documentation/\n \n # docker-sync\n https://docker-sync.readthedocs.io/en/latest/\n")),(0,a.kt)("h2",{id:"2\u5b89\u88c5\u51c6\u5907"},"2.\u5b89\u88c5\u51c6\u5907"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*   [Git](https://git-scm.com/downloads)\n*   [Docker](https://www.docker.com/products/docker/)`>= 17.12\n")),(0,a.kt)("h2",{id:"3\u76ee\u5f55\u7ed3\u6784"},"3.\u76ee\u5f55\u7ed3\u6784"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u5b98\u7f51\u6709\u591a\u79cd\u76ee\u5f55\u683c\u5f0f,\u4e2a\u4eba\u559c\u6b22\u4f7f\u7528\u4e00\u4e2alaradock\u5f53\u505a\u5165\u53e3\u5373\u53ef\n+ laradock  \n+ project-1  \n+ project-2\n")),(0,a.kt)("h2",{id:"4\u5b89\u88c5"},"4.\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/laradock/laradock.git\n")),(0,a.kt)("h2",{id:"5\u914d\u7f6e"},"5.\u914d\u7f6e"),(0,a.kt)("h3",{id:"1\u521b\u5efa\u914d\u7f6e\u6587\u4ef6"},"1.\u521b\u5efa\u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"}," cp env-example .env\n")),(0,a.kt)("h3",{id:"2\u914d\u7f6e\u73af\u5883\u9009\u9879"},"2.\u914d\u7f6e\u73af\u5883\u9009\u9879"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u7b2c\u4e00\u6b65(\u91cd\u8981),\u4fee\u6539\u4e3a\u963f\u91cc\u6e90 (\u5b98\u65b9\u7684php Dockerfile\u4e5f\u5410\u69fd\u4e86\u8fd9\u4e2a...)\nCHANGE_SOURCE=true\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u5bb9\u5668\u73af\u5883\u914d\u7f6e")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// workspace \u5bbf\u4e3b\u673a\u6302\u8f7d\u76ee\u5f55\nAPP_CODE_PATH_HOST=../\n\n// \u5bb9\u5668\u76ee\u5f55\nAPP_CODE_PATH_CONTAINER=/var/www\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u65f6\u533a\nWORKSPACE_TIMEZONE=PRC\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"PHP \u914d\u7f6e")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// php\u7248\u672c\u53ef\u9009: 7.4 - 7.3 - 7.2 - 7.1 - 7.0 - 5.6\nPHP_VERSION=7.3\n\n// \u7f51\u7edc\u539f\u56e0\u8fd9\u4e2a\u6269\u5c55\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b89\u88c5\u5931\u8d25,\u5efa\u8bae\u4fee\u6539\u4e3afalse\nWORKSPACE_INSTALL_IMAGEMAGICK=false\nPHP_FPM_INSTALL_IMAGEMAGICK=false\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"NGINX \u914d\u7f6e")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NGINX_HOST_HTTP_PORT=80     // http \u76d1\u542c\u7aef\u53e3\nNGINX_HOST_HTTPS_PORT=443   // https \u76d1\u542c\u7aef\u53e3\nNGINX_HOST_LOG_PATH=./logs/nginx/  // nginx \u5185\u5bb9\u5668\u65e5\u5fd7\u76ee\u5f55\nNGINX_SITES_PATH=./nginx/sites/     // nginx \u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\nNGINX_PHP_UPSTREAM_CONTAINER=php-fpm    // \u7ed1\u5b9a php-fpm \u5904\u7406\nNGINX_PHP_UPSTREAM_PORT=9000    // php-fpm \u7aef\u53e3\nNGINX_SSL_PATH=./nginx/ssl/     // nginx ssl\u8def\u5f84\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"APACHE \u914d\u7f6e (\u540c\u4e0anginx)")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"APACHE_HOST_HTTP_PORT=80\nAPACHE_HOST_HTTPS_PORT=443\nAPACHE_HOST_LOG_PATH=./logs/apache2\nAPACHE_SITES_PATH=./apache2/sites\nAPACHE_PHP_UPSTREAM_CONTAINER=php-fpm\nAPACHE_PHP_UPSTREAM_PORT=9000\nAPACHE_PHP_UPSTREAM_TIMEOUT=60\nAPACHE_DOCUMENT_ROOT=/var/www/\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"MYSQL \u914d\u7f6e")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"MYSQL_VERSION=5.7   // \u7248\u672c , latest\u4e3a\u6700\u65b0\u7248\nMYSQL_DATABASE=default  // \u9ed8\u8ba4\u521b\u5efa\u7684\u6570\u636e\u5e93\u540d\u79f0\nMYSQL_USER=root // \u7528\u6237\u540d\nMYSQL_PASSWORD=root // \u5bc6\u7801\nMYSQL_PORT=3306 // \u76d1\u542c\u7aef\u53e3\nMYSQL_ROOT_PASSWORD=root    // root\u7528\u6237\u7684\u5bc6\u7801\nMYSQL_ENTRYPOINT_INITDB=./mysql/docker-entrypoint-initdb.d\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"REDIS \u914d\u7f6e")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'REDIS_PORT=6379\n\n# \u9ed8\u8ba4redis\u662f\u6ca1\u6709\u5bc6\u7801\u7684, \u5982\u679c\u8981\u6dfb\u52a0\u5bc6\u7801\n\n// 1-\u4ec5\u4fee\u6539\u5bc6\u7801,\u9700\u8981\u4fee\u6539docker-compose.yml\u7f16\u6392\u6587\u4ef6\nredis:\n      build: ./redis\n      volumes:\n        - ${DATA_PATH_HOST}/redis:/data\n      # \u6dfb\u52a0\u8fd9\u4e00\u884c\u4e3aredis\u8bbe\u7f6e\u5bc6\u7801\n      command: redis-server --requirepass your_password\n      ports:\n        - "${REDIS_PORT}:6379"\n      networks:\n        - backend\n        \n// 2-\u76f4\u63a5\u6dfb\u52a0redis\u7684\u914d\u7f6e\u6587\u4ef6,\u4fee\u6539redis\u7684Dockerfile\n1.  \u6ce8\u91ca `bind 127.0.0.1`  // \u7ed1\u5b9a\u672c\u673aip\n2.  `protected-mode` \u6539\u4e3a `no` // \u53ea\u5141\u8bb8\u672c\u673a\u8bbf\u95ee\n3.  `requirepass your_password` // \u6dfb\u52a0\u4f60\u7684\u5bc6\u7801\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u5176\u5b83\u7c7b\u4f3c\u914d\u7f6e\u53ef\u5728.env\u4e2d\u67e5\u627e,\u4f8b\u5982:\nMemcached,RabbitMQ,phpMyAdmin,ElasticSearch,Varnish,HAProxy,Jenkins,Gitlab,tomcat\u7b49\n")),(0,a.kt)("h3",{id:"3\u914d\u7f6edocker-sync\u53ef\u9009"},"3.\u914d\u7f6edocker-sync(\u53ef\u9009)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'# \u6ce8: \u6b64\u9879\u4e3a\u53ef\u9009\u9879 , \u7528\u4e8e mac/windows \u52a0\u901f\u5bbf\u4e3b\u673a\u548c\u5bb9\u5668\u7684\u6587\u4ef6\u540c\u6b65\u901f\u5ea6\n\n# \u6b65\u9aa4\u4e00 (.env\u4e2d\u4fee\u6539)\n// \u9009\u62e9\u52a0\u8f7d\u7684docker-compose\u7f16\u6392\u6587\u4ef6,\u5982\u679c\u9700\u8981\u4f7f\u7528docker-sync,\u5219\u5728\u6700\u540e\u9762\u52a0\u4e0a":docker-compose.sync.yml"\nCOMPOSE_FILE=docker-compose.yml\n\n// \u53ef\u4ee5\u914d\u7f6e\u6587\u4ef6\u540c\u6b65\u7b56\u7565,mac->native_osx,windows->unison\nDOCKER_SYNC_STRATEGY=native_osx\n\n# \u6b65\u9aa4\u4e8c (docker-compose.sync.yml\u4e2d\u4fee\u6539)\n// \u6dfb\u52a0\u4f60\u9700\u8981\u542f\u52a8\u7684service , \u5982\u679c\u5305\u542bAPP_CODE_PATH_HOST\u53d8\u91cf\u6620\u5c04\u76ee\u5f55,\u4fee\u6539\u6620\u5c04\u5bbf\u4e3b\u76ee\u5f55\u4e3a "applications-sync" , \u6ce8\u610f\u7f29\u8fdb\n')),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image.png",src:t(7110).Z,width:"1406",height:"904"})),(0,a.kt)("h2",{id:"6\u542f\u52a8"},"6.\u542f\u52a8"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# \u6bcf\u6b21\u4fee\u6539\u914d\u7f6e\u6587\u4ef6, \u9700\u8981\u91cd\u65b0build\n\n// \u5148build,\u518d\u542f\u52a8\ncd laradock\ndocker-compose build nginx redis mysql php-fpm workspace\ndocker-compose up -d nginx mysql redis\n\n\n// \u76f4\u63a5\u542f\u52a8 , \u4f1a\u81ea\u52a8build\u62c9\u53d6\ndocker-compose up -d nginx mysql redis php-fpm workspace\n\n")),(0,a.kt)("h2",{id:"7\u5e38\u7528\u6307\u4ee4"},"7.\u5e38\u7528\u6307\u4ee4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'// \u67e5\u770b\u8fd0\u884c\u72b6\u6001 "State" => "up" \u5373\u4e3a\u542f\u52a8\u6210\u529f \ndocker-compose ps\n')),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image.png",src:t(7439).Z,width:"1412",height:"134"})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# \u91cd\u542f / \u5173\u95ed / \u5220\u9664\ndocker-compose restart / stop / down\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// \u8fdb\u5165\u5de5\u4f5c\u5bb9\u5668\ndocker-compose exec workspace bash\n")),(0,a.kt)("h2",{id:"8\u914d\u7f6enginx\u8bbf\u95ee\u670d\u52a1"},"8.\u914d\u7f6enginx\u8bbf\u95ee\u670d\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'// nginx \u4e3b\u914d\u7f6e\u6587\u4ef6\u5df2\u7ecf\u5305\u542b\u4e86 `your_path/laradock/nginx/sites` \u76ee\u5f55\u4e0b\u7684 `*.conf` \u6587\u4ef6\ncp laravel.conf.example laravel.conf\n\n// \u4e0b\u9762\u662f\u4e00\u4efdnginx server\u7684\u914d\u7f6e\u90e8\u5206\u5185\u5bb9\nserver {\n    \n    listen 80;\n    listen [::]:80;\n\n    # For https\n    # listen 443 ssl;\n    # listen [::]:443 ssl ipv6only=on;\n    # ssl_certificate /etc/nginx/ssl/default.crt;\n    # ssl_certificate_key /etc/nginx/ssl/default.key;\n\n    # \u4fee\u6539\u4f60\u7684\u57df\u540d\u6216\u8005ip , \u672c\u673a\u5f00\u53d1\u53ef\u5728 `/etc/hosts` \u4e2d\u4fee\u6539\u6620\u5c04\u5173\u7cfb\n    server_name test.cc;\n    \n    # \u4fee\u6539\u4f60\u7684\u9879\u76ee\u8def\u5f84\n    root /var/www/public;\n    index index.php index.html index.htm;\n\n    location / {\n         try_files $uri $uri/ /index.php$is_args$args;\n    }\n    \n    ...\n    ...\n    ...\n    \n    # \u4fee\u6539\u4f60\u7684\u65e5\u5fd7\u6587\u4ef6\n    error_log /var/log/nginx/laravel_error.log;     \n    access_log /var/log/nginx/laravel_access.log;\n}\n\n// \u5728 `your_path/laradock` \u540c\u7ea7\u76ee\u5f55\u4e0b\nmkdir public\nchmod -R 755 ./public\necho -e "<?php \\n\\r phpinfo();" >> ./public/index.php\n\n// nginx \u4fee\u6539\u4e86\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u91cd\u542f , \u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u91cd\u542f\u5bb9\u5668 , \u5c31\u4e0d\u9ebb\u70e6\u8fdb\u5165nginx \u5bb9\u5668\u53bb\u91cd\u542f nginx\ndocker-compose restart\n\n// \u6d4f\u89c8\u5668\u8f93\u5165 "test.cc" , \u6b64\u65f6\u80fd\u770b\u89c1 phpinfo \u8f93\u5165\u7684\u4fe1\u606f\u5219\u8868\u793a\u914d\u7f6e\u6210\u529f\n')),(0,a.kt)("h2",{id:"9\u7ed3\u675f\u8bed"},"9.\u7ed3\u675f\u8bed"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Use Docker First - Then Learn About It Later")," ",(0,a.kt)("a",{parentName:"p",href:"https://laradock.io/introduction/#use-docker-first-then-learn-about-it-later-q",title:"Permanent link"},"#")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd9\u662f",(0,a.kt)("inlineCode",{parentName:"strong"},"laradock"),"\u5b98\u7f51\u4ecb\u7ecd\u4e0a\u7684\u4e00\u53e5\u8bdd")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4ee5\u4e0a, \u5c31\u662f\u57fa\u4e8elaradock\u642d\u5efaphp+nginx+mysql+redis\u73af\u5883\u7684\u5185\u5bb9\u4e86!")))}u.isMDXComponent=!0},7110:function(e,n,t){n.Z=t.p+"assets/images/laradock-compose-39789d954aab18edda1fe8446f668518.png"},7439:function(e,n,t){n.Z=t.p+"assets/images/laradock-ps-e3247274c5a258cdc0d4827acd97fe66.png"}}]);