"use strict";(self.webpackChunkgo_kitx_webside=self.webpackChunkgo_kitx_webside||[]).push([[5390],{3905:function(e,r,t){t.d(r,{Zo:function(){return c},kt:function(){return f}});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var u=n.createContext({}),p=function(e){var r=n.useContext(u),t=r;return e&&(t="function"==typeof e?e(r):o(o({},r),e)),t},c=function(e){var r=p(e.components);return n.createElement(u.Provider,{value:r},e.children)},s={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},m=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,l=e.originalType,u=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(t),f=a,d=m["".concat(u,".").concat(f)]||m[f]||s[f]||l;return t?n.createElement(d,o(o({ref:r},c),{},{components:t})):n.createElement(d,o({ref:r},c))}));function f(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=m;var i={};for(var u in r)hasOwnProperty.call(r,u)&&(i[u]=r[u]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6346:function(e,r,t){t.r(r),t.d(r,{assets:function(){return c},contentTitle:function(){return u},default:function(){return f},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return s}});var n=t(7462),a=t(3366),l=(t(7294),t(3905)),o=["components"],i={slug:"go-error-handle",title:"go\u9519\u8bef\u5904\u7406\u5de5\u7a0b\u5316\u5b9e\u8df5",authors:["sado"],tags:["golang"],date:"2022-06-07T21:35"},u="\u9519\u8bef\u5904\u7406\u5de5\u7a0b\u5316\u5b9e\u8df5",p={permalink:"/blog/go-error-handle",source:"@site/blog/go/2022-06-07-error-handle.md",title:"go\u9519\u8bef\u5904\u7406\u5de5\u7a0b\u5316\u5b9e\u8df5",description:"1) \u80cc\u666f",date:"2022-06-07T21:35:00.000Z",formattedDate:"June 7, 2022",tags:[{label:"golang",permalink:"/blog/tags/golang"}],readingTime:3.635,truncated:!0,authors:[{name:"sado",title:"Developer",url:"https://github.com/sado0823",imageURL:"/img/avatar.jpeg",key:"sado"}],frontMatter:{slug:"go-error-handle",title:"go\u9519\u8bef\u5904\u7406\u5de5\u7a0b\u5316\u5b9e\u8df5",authors:["sado"],tags:["golang"],date:"2022-06-07T21:35"},nextItem:{title:"token\u4ee4\u724c\u6876\u9650\u6d41\u7b97\u6cd5",permalink:"/blog/token-limit"}},c={authorsImageUrls:[void 0]},s=[{value:"1) \u80cc\u666f",id:"1-\u80cc\u666f",level:2},{value:"2) \u73b0\u72b6",id:"2-\u73b0\u72b6",level:2},{value:"1) \u91cd\u590d\u5904\u7406",id:"1-\u91cd\u590d\u5904\u7406",level:3},{value:"2) \u6ca1\u6709\u5806\u6808",id:"2-\u6ca1\u6709\u5806\u6808",level:3},{value:"3) \u5982\u4f55\u5904\u7406\u9519\u8bef",id:"3-\u5982\u4f55\u5904\u7406\u9519\u8bef",level:2},{value:"1) \u76ee\u6807",id:"1-\u76ee\u6807",level:3},{value:"2) \u65b9\u6cd5",id:"2-\u65b9\u6cd5",level:3},{value:"3) \u6700\u4f73\u5b9e\u8df5",id:"3-\u6700\u4f73\u5b9e\u8df5",level:3},{value:"4) \u6548\u679c",id:"4-\u6548\u679c",level:3},{value:"4) Q&amp;A",id:"4-qa",level:2},{value:"1) ecode\u4e3a\u81ea\u5b9a\u4e49\u9519\u8bef\u4fe1\u606f\u7ed3\u6784\u4f53, \u662f\u5426\u4f1a\u6539\u53d8\u524d\u7aef\u63d0\u793a?",id:"1-ecode\u4e3a\u81ea\u5b9a\u4e49\u9519\u8bef\u4fe1\u606f\u7ed3\u6784\u4f53-\u662f\u5426\u4f1a\u6539\u53d8\u524d\u7aef\u63d0\u793a",level:4},{value:"2) \u6bcf\u4e00\u5c42error\u5411\u4e0a\u629b\u65f6\u5982\u4f55\u643a\u5e26\u4e0a\u4e0b\u6587\u4fe1\u606f?",id:"2-\u6bcf\u4e00\u5c42error\u5411\u4e0a\u629b\u65f6\u5982\u4f55\u643a\u5e26\u4e0a\u4e0b\u6587\u4fe1\u606f",level:4},{value:"5) references",id:"5-references",level:2}],m={toc:s};function f(e){var r=e.components,i=(0,a.Z)(e,o);return(0,l.kt)("wrapper",(0,n.Z)({},m,i,{components:r,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"1-\u80cc\u666f"},"1) \u80cc\u666f"),(0,l.kt)("p",null,"\u2002","\u2002","\u2002","\u2002","\u4e0d\u719f\u6089\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b, \u62ff\u5230\u4e00\u4e2a\u9519\u8bef\u6392\u67e5, \u65e0\u6cd5\u4e32\u8d77\u6765\u6574\u4e2a\u4ee3\u7801\u7684\u8c03\u7528\u94fe\u8def, \u9519\u8bef\u4ea7\u751f\u5806\u6808, \u6392\u67e5\u56f0\u96be\u3001\u7f13\u6162, \u6839\u636etrace\u53ea\u80fd\u770b\u89c1\u670d\u52a1\u8c03\u7528\u94fe"),(0,l.kt)("h2",{id:"2-\u73b0\u72b6"},"2) \u73b0\u72b6"),(0,l.kt)("h3",{id:"1-\u91cd\u590d\u5904\u7406"},"1) \u91cd\u590d\u5904\u7406"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u91cd\u590d: \u9010\u5c42\u8fd4\u56de\u9519\u8bef, \u5404\u5c42\u8bb0\u5f55\u65e5\u5fd7\n\nfunc foo() error{\n    return errors.New("foo")\n}\n \nfunc bar() error{\n \n    err := foo()\n \n    if err != nil {\n \n        log.Error(err)\n \n        return err    // handle error once, \u5e94\u8be5\u8bb0\u65e5\u5fd7\u6216\u8005\u8fd4\u56de\n \n    }\n \n    return nil\n}\n \nfunc handle() error {\n \n    err := bar()\n \n    if err != nil {\n \n        log.Error(err)\n \n        return err    // handle error once, \u5e94\u8be5\u8bb0\u65e5\u5fd7\u6216\u8005\u8fd4\u56de\n \n    }\n \n    return nil\n}\n')),(0,l.kt)("h3",{id:"2-\u6ca1\u6709\u5806\u6808"},"2) \u6ca1\u6709\u5806\u6808"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u6ca1\u6709\u9519\u8bef\u94fe(\u5806\u6808): \u5f53\u9519\u8bef\u5230\u8fbe\u5e94\u7528\u4e0a\u5c42, \u4e0d\u597d\u8ddf\u8e2a\u6839\u6e90\n\nfunc foo() error {\n \n    return errors.New("foo")\n \n}\n \nfunc test() error{\n \n    err := foo()\n \n    if err != nil {\n \n        log.Error(err)\n \n        return err\n \n    }\n \n    return nil\n}\n \nfunc main(){\n \n    err := test()\n \n    if err := nil {\n \n        fmt.Println("%+v",err)    // foo, \u6ca1\u6709\u4ecemain->test->foo\u7684\u5806\u6808\n\n    }\n}\n')),(0,l.kt)("h2",{id:"3-\u5982\u4f55\u5904\u7406\u9519\u8bef"},"3) \u5982\u4f55\u5904\u7406\u9519\u8bef"),(0,l.kt)("h3",{id:"1-\u76ee\u6807"},"1) \u76ee\u6807"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u9519\u8bef\u88ab\u65e5\u5fd7\u8bb0\u5f55, \u4e0d\u91cd\u590d\u8bb0\u5f55"),(0,l.kt)("li",{parentName:"ul"},"\u4e0a\u5c42\u5e94\u7528\u5904\u7406\u9519\u8bef, \u4fdd\u91cd100%\u7684\u5b8c\u6574\u6027"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u6dfb\u52a0\u4e0a\u4e0b\u6587\u4fe1\u606f")),(0,l.kt)("h3",{id:"2-\u65b9\u6cd5"},"2) \u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/pkg/errors@v0.9.1#pkg-functions"},'"github.com/pkg/errors"')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"errors.Wrapf()"),": Wrapf returns an error annotating err with a stack trace (\u5e26\u6709\u5806\u6808, \u91cd\u590d\u4f1a\u6709\u591a\u6b21\u5806\u6808)"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"errors.WithMessagef()"),": WithMessagef annotates err with the format specifier (\u4e0d\u5e26\u5806\u6808, \u53ef\u643a\u5e26\u4fe1\u606f)")),(0,l.kt)("h3",{id:"3-\u6700\u4f73\u5b9e\u8df5"},"3) \u6700\u4f73\u5b9e\u8df5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6700\u5e95\u5c42(\u6bd4\u5982\u516c\u5171\u5e93)\u8fd4\u56de\u539f\u59cb\u9519\u8bef, \u65e0\u9700wrap"),(0,l.kt)("li",{parentName:"ul"},"\u5e94\u7528\u4e0b\u5c42\u6d41\u8f6c\u9519\u8bef, \u4f7f\u7528wrap\u5e26\u4e0a\u5806\u6808"),(0,l.kt)("li",{parentName:"ul"},"\u5e94\u7528\u5185\u65b9\u6cd5\u4e92\u76f8\u8c03\u7528, \u907f\u514d\u91cd\u590dwrap\u5bfc\u81f4\u91cd\u590d\u5806\u6808, withMessage\u643a\u5e26\u4fe1\u606f\u5373\u53ef")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"error-ctx",src:t(3691).Z,width:"2658",height:"1518"})),(0,l.kt)("h3",{id:"4-\u6548\u679c"},"4) \u6548\u679c"),(0,l.kt)("p",null,"\u5728\u6253\u5370\u6216\u8005\u8bb0\u5f55\u9519\u8bef, \u4e00\u822c\u7531\u65e5\u5fd7\u4e2d\u95f4\u4ef6\u5728\u6700\u4e0a\u5c42\u5b8c\u6210, \u4f7f\u7528\u5360\u4f4d\u7b26 ",(0,l.kt)("inlineCode",{parentName:"p"},"%+v"),", \u6bd4\u5982"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// log error with stack\n\nfmt.Printf("err:%+v", err)\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"error-show",src:t(1710).Z,width:"2114",height:"1530"})),(0,l.kt)("h2",{id:"4-qa"},"4) Q&A"),(0,l.kt)("h4",{id:"1-ecode\u4e3a\u81ea\u5b9a\u4e49\u9519\u8bef\u4fe1\u606f\u7ed3\u6784\u4f53-\u662f\u5426\u4f1a\u6539\u53d8\u524d\u7aef\u63d0\u793a"},"1) ecode\u4e3a\u81ea\u5b9a\u4e49\u9519\u8bef\u4fe1\u606f\u7ed3\u6784\u4f53, \u662f\u5426\u4f1a\u6539\u53d8\u524d\u7aef\u63d0\u793a?"),(0,l.kt)("p",null,"\u524d\u7aef\u80fd\u591f\u6b63\u786e\u5c55\u793a\u5bf9\u5e94\u7684\u63d0\u793a\u662f\u57fa\u4e8e\u8fd4\u56de\u7684ecode\u4e2d\u7684code\u548cmessage, \u524d\u7aef\u5c55\u793amessage\u4fe1\u606f\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"wrap\u4e4b\u524d: \u5e94\u7528\u8fd4\u56de\u539f\u59cberror(\u5373\u4e3a\u6839\u56e0error), \u5982\u679c\u8be5error\u4e3aecode, \u62e5\u6709\u5bf9\u5e94\u7684code\u548cmessage, \u5219\u524d\u7aef\u80fd\u6b63\u5e38\u5c55\u793a, \u5426\u5219\u5219\u4e0d\u80fd")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"wrap\u4e4b\u540e: \u5e94\u7528\u5c42\u901a\u7528\u8fd4\u56de\u539f\u59cberror(\u5373\u4e3a\u6839\u56e0error), wrap\u52a0\u4e0a\u5806\u6808, \u51fa\u53e3\u5904\u6846\u67b6\u4f1a\u81ea\u52a8cause\u5bfb\u627e\u6839\u56e0, \u4e4b\u540e\u548cwrap\u4e4b\u524d\u903b\u8f91\u4e00\u81f4"))),(0,l.kt)("p",null,"\u4e5f\u5c31\u662f\u8bf4, \u91cd\u70b9\u5728\u4e8e\u8fd4\u56de\u7684\u539f\u59cberror\u662f\u5426\u4e3aecode\u624d\u662f\u91cd\u70b9, \u4e0e\u662f\u5426wrap\u6ca1\u6709\u5173\u7cfb"),(0,l.kt)("br",null),(0,l.kt)("h4",{id:"2-\u6bcf\u4e00\u5c42error\u5411\u4e0a\u629b\u65f6\u5982\u4f55\u643a\u5e26\u4e0a\u4e0b\u6587\u4fe1\u606f"},"2) \u6bcf\u4e00\u5c42error\u5411\u4e0a\u629b\u65f6\u5982\u4f55\u643a\u5e26\u4e0a\u4e0b\u6587\u4fe1\u606f?"),(0,l.kt)("p",null,"pkg/errors \u5305\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u65b9\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"errors.Wrap(),")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"errors.Wrapf(), ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"errors.WithMessage(), ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"errors.WithMessagef()"))),(0,l.kt)("p",null,"\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Wrap"),"\u7c7b\u4f1a\u643a\u5e26\u5806\u6808, \u5e94\u7528\u4e0b\u5c42\u8c03\u7528\u4e00\u6b21\u5373\u53ef, \u907f\u514d\u591a\u6b21\u8c03\u7528\u9020\u6210\u5806\u6808\u591a\u6b21\u6253\u5370"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"WithMessage"),"\u7c7b\u4e0d\u4f1a\u643a\u5e26\u5806\u6808, \u53ea\u4f1a\u5305\u88c5\u4e00\u5c42"),(0,l.kt)("li",{parentName:"ul"},"\u5e26",(0,l.kt)("inlineCode",{parentName:"li"},"f"),"\u7c7b\u5360\u4f4d\u7b26\u7684\u51fd\u6570, \u53ef\u4ee5\u643a\u5e26\u4e00\u4e9b\u53c2\u6570\u7b49\u4e0a\u4e0b\u6587\u4fe1\u606f")),(0,l.kt)("h2",{id:"5-references"},"5) references"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://golang.org/doc/faq#exceptions"},"go-exceptions")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://rauljordan.com/2020/07/06/why-go-error-handling-is-awesome.html"},"why-go-error-handling-is-awesome")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package"},"stack-traces-and-the-errors"))))}f.isMDXComponent=!0},3691:function(e,r,t){r.Z=t.p+"assets/images/error-ctx-3ecf1b002ecde89610ade6b653d817cf.png"},1710:function(e,r,t){r.Z=t.p+"assets/images/error-show-c8867e398939a5fc941a007e759a23e1.png"}}]);