"use strict";(self.webpackChunkgo_kitx_webside=self.webpackChunkgo_kitx_webside||[]).push([[8930],{3905:function(e,n,t){t.d(n,{Zo:function(){return i},kt:function(){return k}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=o.createContext({}),c=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},i=function(e){var n=c(e.components);return o.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),d=c(t),k=r,m=d["".concat(p,".").concat(k)]||d[k]||u[k]||a;return t?o.createElement(m,s(s({ref:n},i),{},{components:t})):o.createElement(m,s({ref:n},i))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=d;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<a;c++)s[c]=t[c];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7534:function(e,n,t){t.r(n),t.d(n,{assets:function(){return i},contentTitle:function(){return p},default:function(){return k},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var o=t(7462),r=t(3366),a=(t(7294),t(3905)),s=["components"],l={slug:"websocket-swoft",title:"Websocket And Swoft",authors:["sado"],tags:["php","websocket","tcp"],date:"2022-05-24T18:35"},p=void 0,c={permalink:"/blog/websocket-swoft",source:"@site/blog/2022-05-24-websocket-swool.md",title:"Websocket And Swoft",description:"1.Websocket",date:"2022-05-24T18:35:00.000Z",formattedDate:"May 24, 2022",tags:[{label:"php",permalink:"/blog/tags/php"},{label:"websocket",permalink:"/blog/tags/websocket"},{label:"tcp",permalink:"/blog/tags/tcp"}],readingTime:17.125,truncated:!1,authors:[{name:"sado",title:"Developer",url:"https://github.com/sado0823",imageURL:"/img/avatar.jpeg",key:"sado"}],frontMatter:{slug:"websocket-swoft",title:"Websocket And Swoft",authors:["sado"],tags:["php","websocket","tcp"],date:"2022-05-24T18:35"},prevItem:{title:"Rpc And Opentrace",permalink:"/blog/rpc-opentrace"},nextItem:{title:"Second Blog Post",permalink:"/blog/second-blog-post"}},i={authorsImageUrls:[void 0]},u=[{value:"1.Websocket",id:"1websocket",level:2},{value:"1.OSI\u4e03\u5c42\u4e0eTCP/IP\u4e94\u5c42\u6a21\u578b",id:"1osi\u4e03\u5c42\u4e0etcpip\u4e94\u5c42\u6a21\u578b",level:3},{value:"2.socket",id:"2socket",level:3},{value:"3.\u7b80\u4ecb",id:"3\u7b80\u4ecb",level:3},{value:"4.\u4e0eHTTP\u7684\u5bf9\u6bd4",id:"4\u4e0ehttp\u7684\u5bf9\u6bd4",level:3},{value:"5.\u7279\u70b9",id:"5\u7279\u70b9",level:3},{value:"6.\u793a\u4f8b",id:"6\u793a\u4f8b",level:3},{value:"2.swoole",id:"2swoole",level:2},{value:"1.\u7b80\u4ecb",id:"1\u7b80\u4ecb",level:3},{value:"2.\u793a\u4f8b",id:"2\u793a\u4f8b",level:3},{value:"1.http server",id:"1http-server",level:4},{value:"2.websocket server",id:"2websocket-server",level:4},{value:"3.tcp server",id:"3tcp-server",level:4},{value:"4.udp server",id:"4udp-server",level:4},{value:"5.task",id:"5task",level:4},{value:"6.coroutine",id:"6coroutine",level:4},{value:"7.Channel",id:"7channel",level:4},{value:"3.\u98ce\u683c",id:"3\u98ce\u683c",level:3},{value:"1.\u5f02\u6b65\u98ce\u683c",id:"1\u5f02\u6b65\u98ce\u683c",level:4},{value:"2.\u534f\u7a0b\u98ce\u683c",id:"2\u534f\u7a0b\u98ce\u683c",level:4},{value:"4.\u57fa\u672c\u987b\u77e5",id:"4\u57fa\u672c\u987b\u77e5",level:3},{value:"1.\u56db\u79cd\u8bbe\u7f6e\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f",id:"1\u56db\u79cd\u8bbe\u7f6e\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f",level:4},{value:"2.\u540c\u6b65 IO / \u5f02\u6b65 IO",id:"2\u540c\u6b65-io--\u5f02\u6b65-io",level:4},{value:"3.EventLoop",id:"3eventloop",level:4},{value:"4.TCP\u7c98\u5305\u95ee\u9898",id:"4tcp\u7c98\u5305\u95ee\u9898",level:4},{value:"5.IPC",id:"5ipc",level:4},{value:"5.\u5b89\u88c5",id:"5\u5b89\u88c5",level:3},{value:"1.\u6e90\u7801\u5b89\u88c5",id:"1\u6e90\u7801\u5b89\u88c5",level:4},{value:"2.pecl\u5b89\u88c5",id:"2pecl\u5b89\u88c5",level:4},{value:"3.swoft",id:"3swoft",level:2},{value:"1.\u73af\u5883\u51c6\u5907",id:"1\u73af\u5883\u51c6\u5907",level:3},{value:"2.\u5b89\u88c5\u65b9\u5f0f",id:"2\u5b89\u88c5\u65b9\u5f0f",level:3},{value:"1.docker",id:"1docker",level:4},{value:"2.docker-compose",id:"2docker-compose",level:4},{value:"3.composer",id:"3composer",level:4},{value:"4.\u624b\u52a8\u5b89\u88c5",id:"4\u624b\u52a8\u5b89\u88c5",level:4},{value:"5.swoftcli",id:"5swoftcli",level:4},{value:"3.\u76ee\u5f55\u7ed3\u6784",id:"3\u76ee\u5f55\u7ed3\u6784",level:3},{value:"4.\u8fd0\u884c\u670d\u52a1",id:"4\u8fd0\u884c\u670d\u52a1",level:3},{value:"1.http server",id:"1http-server-1",level:4},{value:"2.websocket server",id:"2websocket-server-1",level:4},{value:"3.rpc server",id:"3rpc-server",level:4},{value:"5.\u6ce8\u89e3",id:"5\u6ce8\u89e3",level:3},{value:"6.IoC - DI",id:"6ioc---di",level:3}],d={toc:u};function k(e){var n=e.components,l=(0,r.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},d,l,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"1websocket"},"1.Websocket"),(0,a.kt)("h3",{id:"1osi\u4e03\u5c42\u4e0etcpip\u4e94\u5c42\u6a21\u578b"},"1.OSI\u4e03\u5c42\u4e0eTCP/IP\u4e94\u5c42\u6a21\u578b"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200415173221790",src:t(6488).Z,width:"2342",height:"850"})),(0,a.kt)("h3",{id:"2socket"},"2.socket"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"Socket\u5b9e\u9645\u4e0a\u662f\u5bf9TCP/IP\u534f\u8bae\u7684\u5c01\u88c5\uff0c\u672c\u8eab\u5e76\u4e0d\u662f\u534f\u8bae\uff0c\u800c\u662f\u4e00\u4e2a\u8c03\u7528\u63a5\u53e3\uff08API\uff09.\n\nSocket\u7684\u51fa\u73b0\u53ea\u662f\u4f7f\u5f97\u7a0b\u5e8f\u5458\u66f4\u65b9\u4fbf\u5730\u4f7f\u7528TCP/IP\u534f\u8bae\u6808\u800c\u5df2\uff0c\u662f\u5bf9TCP/IP\u534f\u8bae\u7684\u62bd\u8c61\uff0c\u4ece\u800c\u5f62\u6210\u4e86\u6211\u4eec\u77e5\u9053\u7684\u4e00\u4e9b\u6700\u57fa\u672c\u7684\u51fd\u6570\u63a5\u53e3.\n\n\u6bd4\u5982create\u3001listen\u3001connect\u3001accept\u3001send\u3001read\u548cwrite.\n")),(0,a.kt)("h3",{id:"3\u7b80\u4ecb"},"3.\u7b80\u4ecb"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"WebSocket \u662f\u4e00\u79cd\u7f51\u7edc\u901a\u4fe1\u534f\u8bae.\n\nWebSocket \u534f\u8bae\u57282008\u5e74\u8bde\u751f\uff0c2011\u5e74\u6210\u4e3a\u56fd\u9645\u6807\u51c6\u3002\u6240\u6709\u6d4f\u89c8\u5668\u90fd\u5df2\u7ecf\u652f\u6301\u4e86.\n\n\u670d\u52a1\u5668\u53ef\u4ee5\u4e3b\u52a8\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u4fe1\u606f\uff0c\u5ba2\u6237\u7aef\u4e5f\u53ef\u4ee5\u4e3b\u52a8\u5411\u670d\u52a1\u5668\u53d1\u9001\u4fe1\u606f\uff0c\u5c5e\u4e8e\u670d\u52a1\u5668\u63a8\u9001\u6280\u672f\u7684\u4e00\u79cd\u3002\n\n`\u957f\u94fe\u63a5`\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u670d\u52a1\u5668\u63a8\u9001\u6280\u672f\n1   Webpush\n2   HTTP server push\n3   Pushlet\n4   Long polling\n5   Flash XMLSocket relays\n6   Reliable Group Data Delivery (RGDD)\n7   Push notification\n")),(0,a.kt)("h3",{id:"4\u4e0ehttp\u7684\u5bf9\u6bd4"},"4.\u4e0eHTTP\u7684\u5bf9\u6bd4"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200415174047471",src:t(1709).Z,width:"1248",height:"1018"})),(0,a.kt)("h3",{id:"5\u7279\u70b9"},"5.\u7279\u70b9"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\n\uff081\uff09\u5efa\u7acb\u5728 TCP \u534f\u8bae\u4e4b\u4e0a\uff0c\u670d\u52a1\u5668\u7aef\u7684\u5b9e\u73b0\u6bd4\u8f83\u5bb9\u6613\u3002\n\n\uff082\uff09\u4e0e HTTP \u534f\u8bae\u6709\u7740\u826f\u597d\u7684\u517c\u5bb9\u6027\u3002\u9ed8\u8ba4\u7aef\u53e3\u4e5f\u662f`80`\u548c`443`\uff0c\u5e76\u4e14\u63e1\u624b\u9636\u6bb5\u91c7\u7528 HTTP \u534f\u8bae\uff0c\u56e0\u6b64\u63e1\u624b\u65f6\u4e0d\u5bb9\u6613\u5c4f\u853d\uff0c\u80fd\u901a\u8fc7\u5404\u79cd HTTP \u4ee3\u7406\u670d\u52a1\u5668\u3002\n\n\uff083\uff09\u6570\u636e\u683c\u5f0f\u6bd4\u8f83\u8f7b\u91cf\uff0c\u6027\u80fd\u5f00\u9500\u5c0f\uff0c\u901a\u4fe1\u9ad8\u6548\u3002\n\n\uff084\uff09\u53ef\u4ee5\u53d1\u9001\u6587\u672c\uff0c\u4e5f\u53ef\u4ee5\u53d1\u9001\u4e8c\u8fdb\u5236\u6570\u636e\u3002\n\n\uff085\uff09\u6ca1\u6709`\u540c\u6e90\u9650\u5236`\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4e0e\u4efb\u610f\u670d\u52a1\u5668\u901a\u4fe1\u3002\n\n\uff086\uff09\u534f\u8bae\u6807\u8bc6\u7b26\u662f`ws`\uff08\u5982\u679c\u52a0\u5bc6\uff0c\u5219\u4e3awss\uff09\uff0c\u670d\u52a1\u5668\u7f51\u5740\u5c31\u662f URL\u3002   (scheme)\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"ws://example.com:80/uri\nwss://example.com:80/uri\n")),(0,a.kt)("h3",{id:"6\u793a\u4f8b"},"6.\u793a\u4f8b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'# \u5ba2\u6237\u7aef\nlet ws = new WebSocket("wss://echo.websocket.org");\n\nws.onopen = function(evt) { \n  console.log("Connection open ..."); \n  ws.send("Hello WebSockets!");\n};\n\nws.onmessage = function(evt) {\n  console.log( "Received Message: " + evt.data);\n  ws.close();\n};\n\nws.onclose = function(evt) {\n  console.log("Connection closed.");\n};\n\n# \u670d\u52a1\u7aef\nphp -> socket_create(),  new Socket\npython -> socket,\ngo -> gorilla/websocket\nnode -> socket.io / socket.io -client\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u8c03\u8bd5\nhttps://jsbin.com/?js,console,output\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# webSocket.readyState\nreadyState\u5c5e\u6027\u8fd4\u56de\u5b9e\u4f8b\u5bf9\u8c61\u7684\u5f53\u524d\u72b6\u6001\uff0c\u5171\u6709\u56db\u79cd\u3002\nCONNECTING\uff1a\u503c\u4e3a0\uff0c\u8868\u793a\u6b63\u5728\u8fde\u63a5\u3002\nOPEN\uff1a\u503c\u4e3a1\uff0c\u8868\u793a\u8fde\u63a5\u6210\u529f\uff0c\u53ef\u4ee5\u901a\u4fe1\u4e86\u3002\nCLOSING\uff1a\u503c\u4e3a2\uff0c\u8868\u793a\u8fde\u63a5\u6b63\u5728\u5173\u95ed\u3002\nCLOSED\uff1a\u503c\u4e3a3\uff0c\u8868\u793a\u8fde\u63a5\u5df2\u7ecf\u5173\u95ed\uff0c\u6216\u8005\u6253\u5f00\u8fde\u63a5\u5931\u8d25\u3002\n")),(0,a.kt)("h2",{id:"2swoole"},"2.swoole"),(0,a.kt)("h3",{id:"1\u7b80\u4ecb"},"1.\u7b80\u4ecb"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\u4f5c\u8005 \u97e9\u5929\u5cf0 \npecl\u5f00\u53d1\u7ec4\u6210\u5458\n\nphp\u6269\u5c55\n\nSwoole \u662f\u4e00\u4e2a PHP \u7684 `\u534f\u7a0b` `\u9ad8\u6027\u80fd` \u7f51\u7edc\u901a\u4fe1\u5f15\u64ce\uff0c\u4f7f\u7528 C/C++ \u8bed\u8a00\u7f16\u5199\uff0c\u63d0\u4f9b\u4e86\u591a\u79cd\u901a\u4fe1\u534f\u8bae\u7684\u7f51\u7edc\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u6a21\u5757\u3002\u53ef\u4ee5\u65b9\u4fbf\u5feb\u901f\u7684\u5b9e\u73b0 TCP/UDP\u670d\u52a1\u3001\u9ad8\u6027\u80fdWeb\u3001WebSocket\u670d\u52a1\u3001\u7269\u8054\u7f51\u3001\u5b9e\u65f6\u901a\u8baf\u3001\u6e38\u620f\u3001\u5fae\u670d\u52a1\u7b49\uff0c\u4f7f PHP \u4e0d\u518d\u5c40\u9650\u4e8e\u4f20\u7edf\u7684 Web \u9886\u57df\u3002\n\n4.4+\u4e4b\u540e, \u5168\u9762\u534f\u7a0b\u5316, PHP \u534f\u7a0b\u6846\u67b6 \n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u6587\u6863\nhttps://www.swoole.com/\n")),(0,a.kt)("p",null,"php-fpm` \u5904\u7406\u8bf7\u6c42"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"sapi"),"---\x3e \u521d\u59cb\u5316http\u7684\u73af\u5883\u53d8\u91cf"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"phpcore")," ---\x3e \u521d\u59cb\u5316php\u62d3\u5c55, \u521d\u59cb\u5316\u4e0a\u4e0b\u6587\u73af\u5883"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200417173904872",src:t(485).Z,width:"1672",height:"858"})),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u6267\u884cphp\u811a\u672c")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image-20200417173929936",src:t(4844).Z,width:"1190",height:"1280"})),(0,a.kt)("h3",{id:"2\u793a\u4f8b"},"2.\u793a\u4f8b"),(0,a.kt)("h4",{id:"1http-server"},"1.http server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'        $http = new Swoole\\Http\\Server("127.0.0.1", 9501);\n\n    $http->on("start", function ($server) {\n        echo "Swoole http server is started at http://127.0.0.1:9501\\n";\n    });\n\n    $http->on("request", function ($request, $response) {\n        $response->header("Content-Type", "text/plain");\n        $response->end("Hello World\\n");\n    });\n\n    $http->start();\n')),(0,a.kt)("h4",{id:"2websocket-server"},"2.websocket server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'        $server = new Swoole\\Websocket\\Server("127.0.0.1", 9502);\n\n    $server->on(\'open\', function($server, $req) {\n        echo "connection open: {$req->fd}\\n";\n    });\n\n    $server->on(\'message\', function($server, $frame) {\n        echo "received message: {$frame->data}\\n";\n        $server->push($frame->fd, json_encode(["hello", "world"]));\n    });\n\n    $server->on(\'close\', function($server, $fd) {\n        echo "connection close: {$fd}\\n";\n    });\n\n    $server->start();\n\n')),(0,a.kt)("h4",{id:"3tcp-server"},"3.tcp server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'        $server = new Swoole\\Server("127.0.0.1", 9503);\n    $server->on(\'connect\', function ($server, $fd){\n        echo "connection open: {$fd}\\n";\n    });\n    $server->on(\'receive\', function ($server, $fd, $reactor_id, $data) {\n        $server->send($fd, "Swoole: {$data}");\n        $server->close($fd);\n    });\n    $server->on(\'close\', function ($server, $fd) {\n        echo "connection close: {$fd}\\n";\n    });\n    $server->start();\n')),(0,a.kt)("h4",{id:"4udp-server"},"4.udp server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"        $serv = new Swoole\\Server(\"127.0.0.1\", 9502, SWOOLE_PROCESS, SWOOLE_SOCK_UDP);\n\n    //\u76d1\u542c\u6570\u636e\u63a5\u6536\u4e8b\u4ef6\n    $serv->on('Packet', function ($serv, $data, $clientInfo) {\n        $serv->sendto($clientInfo['address'], $clientInfo['port'], \"Server \".$data);\n        var_dump($clientInfo);\n    });\n\n    //\u542f\u52a8\u670d\u52a1\u5668\n    $serv->start();\n")),(0,a.kt)("h4",{id:"5task"},"5.task"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'$server = new Swoole\\Server("127.0.0.1", 9502);\n    $server->set(array(\'task_worker_num\' => 4));\n    $server->on(\'receive\', function($server, $fd, $reactor_id, $data) {\n        $task_id = $server->task("Async");\n        echo "Dispatch AsyncTask: [id=$task_id]\\n";\n    });\n    $server->on(\'task\', function ($server, $task_id, $reactor_id, $data) {\n        echo "New AsyncTask[id=$task_id]\\n";\n        $server->finish("$data -> OK");\n    });\n    $server->on(\'finish\', function ($server, $task_id, $data) {\n        echo "AsyncTask[$task_id] finished: {$data}\\n";\n    });\n    $server->start();\n')),(0,a.kt)("h4",{id:"6coroutine"},"6.coroutine"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"//\u7761\u7720 1 \u4e07\u6b21\uff0c\u8bfb\u53d6\uff0c\u5199\u5165\uff0c\u68c0\u67e5\u548c\u5220\u9664\u6587\u4ef6 1 \u4e07\u6b21\uff0c\u4f7f\u7528 PDO \u548c MySQLi \u4e0e\u6570\u636e\u5e93\u901a\u4fe1 1 \u4e07\u6b21\uff0c\u521b\u5efa TCP \u670d\u52a1\u5668\u548c\u591a\u4e2a\u5ba2\u6237\u7aef\u76f8\u4e92\u901a\u4fe1 1 \u4e07\u6b21\uff0c\n//\u521b\u5efa UDP \u670d\u52a1\u5668\u548c\u591a\u4e2a\u5ba2\u6237\u7aef\u5230\u76f8\u4e92\u901a\u4fe1 1 \u4e07\u6b21...... \u4e00\u5207\u90fd\u5728\u4e00\u4e2a\u8fdb\u7a0b\u4e00\u79d2\u5185\u5b8c\u7f8e\u5b8c\u6210\uff01\n\n   Swoole\\Runtime::enableCoroutine();//\u6b64\u884c\u4ee3\u7801\u540e\uff0c\u6587\u4ef6\u64cd\u4f5c\uff0csleep\uff0cMysqli\uff0cPDO\uff0cstreams\u7b49\u90fd\u53d8\u6210\u5f02\u6b65IO\uff0c\u89c1\u6587\u6863'\u4e00\u952e\u534f\u7a0b\u5316'\u7ae0\u8282\n   $s = microtime(true);\n    //Co/run()\u89c1\u6587\u6863'\u534f\u7a0b\u5bb9\u5668'\u7ae0\u8282\n   Co\\run(function() {\n    // i just want to sleep...\n    for ($c = 100; $c--;) {\n        go(function () {\n            for ($n = 100; $n--;) {\n                usleep(1000);\n            }\n        });\n    }\n\n    // 10k file read and write\n    for ($c = 100; $c--;) {\n        go(function () use ($c) {\n            $tmp_filename = \"/tmp/test-{$c}.php\";\n            for ($n = 100; $n--;) {\n                $self = file_get_contents(__FILE__);\n                file_put_contents($tmp_filename, $self);\n                assert(file_get_contents($tmp_filename) === $self);\n            }\n            unlink($tmp_filename);\n        });\n    }\n\n    // 10k pdo and mysqli read\n    for ($c = 50; $c--;) {\n        go(function () {\n            $pdo = new PDO('mysql:host=127.0.0.1;dbname=test;charset=utf8', 'root', 'root');\n            $statement = $pdo->prepare('SELECT * FROM `user`');\n            for ($n = 100; $n--;) {\n                $statement->execute();\n                assert(count($statement->fetchAll()) > 0);\n            }\n        });\n    }\n    for ($c = 50; $c--;) {\n        go(function () {\n            $mysqli = new Mysqli('127.0.0.1', 'root', 'root', 'test');\n            $statement = $mysqli->prepare('SELECT `id` FROM `user`');\n            for ($n = 100; $n--;) {\n                $statement->bind_result($id);\n                $statement->execute();\n                $statement->fetch();\n                assert($id > 0);\n            }\n        });\n    }\n\n    // php_stream tcp server & client with 12.8k requests in single process\n    function tcp_pack(string $data): string\n    {\n        return pack('n', strlen($data)) . $data;\n    }\n\n    function tcp_length(string $head): int\n    {\n        return unpack('n', $head)[1];\n    }\n\n    go(function () {\n        $ctx = stream_context_create(['socket' => ['so_reuseaddr' => true, 'backlog' => 128]]);\n        $socket = stream_socket_server(\n            'tcp://0.0.0.0:9502',\n            $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN, $ctx\n        );\n        if (!$socket) {\n            echo \"$errstr ($errno)\\n\";\n        } else {\n            $i = 0;\n            while ($conn = stream_socket_accept($socket, 1)) {\n                stream_set_timeout($conn, 5);\n                for ($n = 100; $n--;) {\n                    $data = fread($conn, tcp_length(fread($conn, 2)));\n                    assert($data === \"Hello Swoole Server #{$n}!\");\n                    fwrite($conn, tcp_pack(\"Hello Swoole Client #{$n}!\"));\n                }\n                if (++$i === 128) {\n                    fclose($socket);\n                    break;\n                }\n            }\n        }\n    });\n    for ($c = 128; $c--;) {\n        go(function () {\n            $fp = stream_socket_client(\"tcp://127.0.0.1:9502\", $errno, $errstr, 1);\n            if (!$fp) {\n                echo \"$errstr ($errno)\\n\";\n            } else {\n                stream_set_timeout($fp, 5);\n                for ($n = 100; $n--;) {\n                    fwrite($fp, tcp_pack(\"Hello Swoole Server #{$n}!\"));\n                    $data = fread($fp, tcp_length(fread($fp, 2)));\n                    assert($data === \"Hello Swoole Client #{$n}!\");\n                }\n                fclose($fp);\n            }\n        });\n    }\n\n    // udp server & client with 12.8k requests in single process\n    go(function () {\n        $socket = new Swoole\\Coroutine\\Socket(AF_INET, SOCK_DGRAM, 0);\n        $socket->bind('127.0.0.1', 9503);\n        $client_map = [];\n        for ($c = 128; $c--;) {\n            for ($n = 0; $n < 100; $n++) {\n                $recv = $socket->recvfrom($peer);\n                $client_uid = \"{$peer['address']}:{$peer['port']}\";\n                $id = $client_map[$client_uid] = ($client_map[$client_uid] ?? -1) + 1;\n                assert($recv === \"Client: Hello #{$id}!\");\n                $socket->sendto($peer['address'], $peer['port'], \"Server: Hello #{$id}!\");\n            }\n        }\n        $socket->close();\n    });\n    for ($c = 128; $c--;) {\n        go(function () {\n            $fp = stream_socket_client(\"udp://127.0.0.1:9503\", $errno, $errstr, 1);\n            if (!$fp) {\n                echo \"$errstr ($errno)\\n\";\n            } else {\n                for ($n = 0; $n < 100; $n++) {\n                    fwrite($fp, \"Client: Hello #{$n}!\");\n                    $recv = fread($fp, 1024);\n                    list($address, $port) = explode(':', (stream_socket_get_name($fp, true)));\n                    assert($address === '127.0.0.1' && (int)$port === 9503);\n                    assert($recv === \"Server: Hello #{$n}!\");\n                }\n                fclose($fp);\n            }\n        });\n    }\n  });\n  echo 'use ' . (microtime(true) - $s) . ' s';\n")),(0,a.kt)("h4",{id:"7channel"},"7.Channel"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"}," Co\\run(function(){\n        //\u4f7f\u7528Channel\u8fdb\u884c\u534f\u7a0b\u95f4\u901a\u8baf\n        $chan = new Swoole\\Coroutine\\Channel(1);\n        Swoole\\Coroutine::create(function () use ($chan) {\n            for($i = 0; $i < 100000; $i++) {\n                co::sleep(1.0);\n                $chan->push(['rand' => rand(1000, 9999), 'index' => $i]);\n                echo \"$i\\n\";\n            }\n        });\n        Swoole\\Coroutine::create(function () use ($chan) {\n            while(1) {\n                $data = $chan->pop();\n                var_dump($data);\n            }\n        });\n  });\n")),(0,a.kt)("h3",{id:"3\u98ce\u683c"},"3.\u98ce\u683c"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u670d\u52a1\u7aef")," + ",(0,a.kt)("inlineCode",{parentName:"p"},"\u5ba2\u6237\u7aef")),(0,a.kt)("h4",{id:"1\u5f02\u6b65\u98ce\u683c"},"1.\u5f02\u6b65\u98ce\u683c"),(0,a.kt)("h4",{id:"2\u534f\u7a0b\u98ce\u683c"},"2.\u534f\u7a0b\u98ce\u683c"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u8fdb\u7a0b"),"   ---\x3e  ",(0,a.kt)("inlineCode",{parentName:"p"},"\u7ebf\u7a0b"),"  ---\x3e   ",(0,a.kt)("inlineCode",{parentName:"p"},"\u534f\u7a0b"),"\t"),(0,a.kt)("p",null," ",(0,a.kt)("inlineCode",{parentName:"p"},"\u8fde\u63a5\u6c60")," (server\u7684manager\u6a21\u5757)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u521b\u5efa\n`Coroutine::create` \u6216 `go` \u65b9\u6cd5\u521b\u5efa\u534f\u7a0b\n\n\u652f\u6301 `waitgroup`\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u901a\u4fe1\u95ee\u9898\n     \u8fdb\u7a0b\n             \u9ad8\u6027\u80fd\u5171\u4eab\u5185\u5b58 `Table`\n       `Process`\u6a21\u5757 (\u4ee3\u66ffphp\u81ea\u5e26\u7684 `pcntl` )\n   \u534f\u7a0b\n       `Coroutine\\Channel`\n        \u5e76\u53d1\u7f16\u7a0b: Coroutine::create() + setdefer()  ->   go() + channel\n\n\n\u9000\u51fa\u534f\u7a0b`exit`\u7981\u7528\n`\u5f02\u5e38\u6355\u83b7`\u4e0d\u80fd\u8de8\u534f\u7a0b\n\u5728\u591a\u4e2a\u534f\u7a0b\u95f4\u4e0d\u80fd`\u5171\u7528`\u4e00\u4e2a\u8fde\u63a5\n\u7981\u6b62\u4f7f\u7528`\u9759\u6001\u7c7b`\u6216\u8005`\u5168\u5c40\u53d8\u91cf`\u4fdd\u5b58\u4e0a\u4e0b\u6587\u5bf9\u8c61\n`sleep`\u4e0d\u80fd\u7528\n")),(0,a.kt)("h3",{id:"4\u57fa\u672c\u987b\u77e5"},"4.\u57fa\u672c\u987b\u77e5"),(0,a.kt)("h4",{id:"1\u56db\u79cd\u8bbe\u7f6e\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f"},"1.\u56db\u79cd\u8bbe\u7f6e\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u533f\u540d\u51fd\u6570\n$server->on('Request', function ($req, $resp) use ($a, $b, $c) {\n    echo \"hello world\";\n});\nCopy to clipboardErrorCopied\n\u53ef\u4f7f\u7528 use \u5411\u533f\u540d\u51fd\u6570\u4f20\u9012\u53c2\u6570\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u7c7b\u9759\u6001\u65b9\u6cd5\nclass A\n{\n    static function test($req, $resp)\n    {\n        echo \"hello world\";\n    }\n}\n$server->on('Request', 'A::Test');\n$server->on('Request', array('A', 'Test'));\nCopy to clipboardErrorCopied\n\u5bf9\u5e94\u7684\u9759\u6001\u65b9\u6cd5\u5fc5\u987b\u4e3a public\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u51fd\u6570\nfunction my_onRequest($req, $resp)\n{\n    echo \"hello world\";\n}\n$server->on('Request', 'my_onRequest');\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u5bf9\u8c61\u65b9\u6cd5\nclass A\n{\n    function test($req, $resp)\n    {\n        echo \"hello world\";\n    }\n}\n$object = new A();\n$server->on('Request', array($object, 'test'));\n\u5bf9\u5e94\u7684\u65b9\u6cd5\u5fc5\u987b\u4e3a public\n")),(0,a.kt)("h4",{id:"2\u540c\u6b65-io--\u5f02\u6b65-io"},"2.\u540c\u6b65 IO / \u5f02\u6b65 IO"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u7f51\u7edcio\u6a21\u578b:\n\u540c\u6b65\u6a21\u578b\uff08synchronous IO\uff09\n\u963b\u585eIO\uff08bloking IO\uff09\n\u975e\u963b\u585eIO\uff08non-blocking IO\uff09\n\u591a\u8def\u590d\u7528IO\uff08multiplexing IO\uff09 `poll/select`  -> `epoll`\n\u4fe1\u53f7\u9a71\u52a8\u5f0fIO\uff08signal-driven IO\uff09\n\u5f02\u6b65IO\uff08asynchronous IO\uff09\n")),(0,a.kt)("h4",{id:"3eventloop"},"3.EventLoop"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\u6240\u8c13 EventLoop\uff0c\u5373\u4e8b\u4ef6\u5faa\u73af\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a `epoll_wait`\uff0c\u6211\u4eec\u4f1a\u628a\u6240\u6709\u8981\u53d1\u751f\u4e8b\u4ef6\u7684\u53e5\u67c4\uff08fd\uff09\u52a0\u5165\u5230 epoll_wait \u4e2d\uff0c\u8fd9\u4e9b\u4e8b\u4ef6\u5305\u62ec\u53ef\u8bfb\uff0c\u53ef\u5199\uff0c\u51fa\u9519\u7b49\u3002 \u6211\u4eec\u7684\u8fdb\u7a0b\u5c31\u963b\u585e\u5728 epoll_wait \u8fd9\u4e2a\u5185\u6838\u51fd\u6570\u4e0a\uff0c\u5f53\u53d1\u751f\u4e86\u4e8b\u4ef6 (\u6216\u8d85\u65f6) \u540e epoll_wait \u8fd9\u4e2a\u51fd\u6570\u5c31\u4f1a\u7ed3\u675f\u963b\u585e\u8fd4\u56de\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u56de\u8c03\u76f8\u5e94\u7684 PHP \u51fd\u6570\uff0c\u4f8b\u5982\uff0c\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6570\u636e\uff0c\u56de\u8c03 OnRecieve \u56de\u8c03\u51fd\u6570\u3002\n\n\u5f53\u6709\u5927\u91cf\u7684 fd \u653e\u5165\u5230\u4e86 epoll_wait \u4e2d\uff0c\u5e76\u4e14\u540c\u65f6\u4ea7\u751f\u4e86\u5927\u91cf\u7684\u4e8b\u4ef6\uff0cepoll_wait \u51fd\u6570\u8fd4\u56de\u7684\u65f6\u5019\u6211\u4eec\u5c31\u4f1a\u6328\u4e2a\u8c03\u7528\u76f8\u5e94\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53eb\u505a\u4e00\u8f6e\u4e8b\u4ef6\u5faa\u73af\uff0c\u5373 IO \u591a\u8def\u590d\u7528\uff0c\u7136\u540e\u518d\u6b21\u963b\u585e\u8c03\u7528 epoll_wait \u8fdb\u884c\u4e0b\u4e00\u8f6e\u4e8b\u4ef6\u5faa\u73af\u3002\n")),(0,a.kt)("h4",{id:"4tcp\u7c98\u5305\u95ee\u9898"},"4.TCP\u7c98\u5305\u95ee\u9898"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"tcp \u5c01\u5305 \u89e3\u5305 \u7c98\u5305 \n\u6570\u636e\u5c01\u5305\u534f\u8bae\u89c4\u5b9a\uff1a\u6574\u4e2a\u6570\u636e\u5305\u5305\u542b2\u5b57\u8282\u957f\u5ea6\u4fe1\u606f+\u6570\u636e\u5305\u4f53\u30022\u5b57\u8282\u957f\u5ea6\u4fe1\u606f\u5305\u542b\u672c\u8eab\u77402\u5b57\u8282\u3002\n\u5982\uff1a\u6570\u636e\u4f53\u662f\uff08abcdefg\uff097\u4e2a\u5b57\u8282\uff0c\u6574\u4f53\u5c01\u5305\u5c31\u662f09abcdefg\uff0c\u603b\u5171\u662f9\u4e2a\u5b57\u8282\u7684\u534f\u8bae\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"EOF \u7ed3\u675f\u7b26\u534f\u8bae\n\u56fa\u5b9a\u5305\u5934 + \u5305\u4f53\u534f\u8bae\n")),(0,a.kt)("h4",{id:"5ipc"},"5.IPC"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\u540c\u4e00\u53f0\u4e3b\u673a\u4e0a\u4e24\u4e2a\u8fdb\u7a0b\u95f4\u901a\u4fe1 (`Inter-Process Communication`)\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\u5728 Swoole \u4e0b\u4f7f\u7528\u4e86 2 \u79cd\u65b9\u5f0f :\n\n# Unix Socket :\n\u5168\u540d UNIX Domain Socket, \u7b80\u79f0 UDS\nSOCK_STREAM : \u6570\u636e\u5927\u7528 (\u6709\u7c98\u5305\u95ee\u9898)\nSOCK_DGRAM : \u6570\u636e\u5c0f\u7528 (64k)\n\n# sysvmsg :\nLinux \u63d0\u4f9b\u7684\u6d88\u606f\u961f\u5217\uff0c\u8fd9\u79cd IPC \u65b9\u5f0f\u901a\u8fc7\u4e00\u4e2a\u6587\u4ef6\u540d\u6765\u4f5c\u4e3a key \u8fdb\u884c\u901a\u8baf\uff0c\u8fd9\u79cd\u65b9\u5f0f\u975e\u5e38\u7684\u4e0d\u7075\u6d3b\uff0c\u5b9e\u9645\u9879\u76ee\u4f7f\u7528\u7684\u5e76\u4e0d\u591a\n")),(0,a.kt)("h3",{id:"5\u5b89\u88c5"},"5.\u5b89\u88c5"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u6269\u5c55\u51b2\u7a81")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"xdebug\nphptrace\naop\nmolten\nxhprof\nphalcon\uff08Swoole \u534f\u7a0b\u65e0\u6cd5\u8fd0\u884c\u5728 phalcon \u6846\u67b6\u4e2d\uff09\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u5fc5\u987b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"php-7.1 \u6216\u66f4\u9ad8\u7248\u672c\ngcc-4.8 \u6216\u66f4\u9ad8\u7248\u672c\nmake\nautoconf\n")),(0,a.kt)("h4",{id:"1\u6e90\u7801\u5b89\u88c5"},"1.\u6e90\u7801\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"#1. \u4e0b\u8f7d swoole \u6e90\u7801\nhttps://github.com/swoole/swoole-src/releases\nhttp://pecl.php.net/package/swoole\nhttp://git.oschina.net/swoole/swoole\n\n#2. \u4ece\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5\n\u4e0b\u8f7d\u6e90\u4ee3\u7801\u5305\u540e\uff0c\u5728\u7ec8\u7aef\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u7f16\u8bd1\u548c\u5b89\u88c5\ncd swoole-src && \\\nphpize && \\\n./configure && \\\n--enable-openssl  \\\n--enable-http2 && \\\nmake && sudo make install\n\n#3. \u542f\u7528\u6269\u5c55\n\u7f16\u8bd1\u5b89\u88c5\u5230\u7cfb\u7edf\u6210\u529f\u540e\uff0c\u9700\u8981\u5728 php.ini \u4e2d\u52a0\u5165\u4e00\u884c extension=swoole.so \u6765\u542f\u7528 Swoole \u6269\u5c55\n")),(0,a.kt)("h4",{id:"2pecl\u5b89\u88c5"},"2.pecl\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"pecl install swoole\n")),(0,a.kt)("h2",{id:"3swoft"},"3.swoft"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"version:2.x")),(0,a.kt)("h3",{id:"1\u73af\u5883\u51c6\u5907"},"1.\u73af\u5883\u51c6\u5907"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"#\u5fc5\u8981\u90e8\u5206\nPHP\uff0c\u7248\u672c >=7.1\nPHP \u5305\u7ba1\u7406\u5668 Composer\nPCRE \u5e93\nPHP \u6269\u5c55 Swoole\uff0c\u7248\u672c >=4.3\n\u989d\u5916\u6269\u5c55\uff1aPDO\u3001Redis\n\n#\u51b2\u7a81\u90e8\u5206\nXdebug\nXhprof\nBlackfire\nZend\ntrace\nUopz\n")),(0,a.kt)("h3",{id:"2\u5b89\u88c5\u65b9\u5f0f"},"2.\u5b89\u88c5\u65b9\u5f0f"),(0,a.kt)("h4",{id:"1docker"},"1.docker"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"docker run -p 18306:18306 --name swoft swoft/swoft\n")),(0,a.kt)("h4",{id:"2docker-compose"},"2.docker-compose"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"git clone https://github.com/swoft-cloud/swoft\ncd swoft\ndocker-compose up\n\n# sserver\u4e0b\u9762\u6709\u4ee5\u4e0b\u6587\u4ef6\u914d\u7f6e\ndocker-compose.yml\ndocker-sync -> rsync , native_osx\n")),(0,a.kt)("h4",{id:"3composer"},"3.composer"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"composer create-project swoft/swoft Swoft\n")),(0,a.kt)("h4",{id:"4\u624b\u52a8\u5b89\u88c5"},"4.\u624b\u52a8\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"git clone https://github.com/swoft-cloud/swoft\ncd swoft\ncomposer install\ncp .env.example .env\n")),(0,a.kt)("h4",{id:"5swoftcli"},"5.swoftcli"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u652f\u6301\u4ece\u4e0d\u540c\u6a21\u677f\u9879\u76ee\u4e2d\u5feb\u901f\u521b\u5efa\u4e00\u4e2a\u5e72\u51c0\u7684 Swoft \u5e94\u7528\nphp swoftcli.phar create:app --type full Swoft-Full\nphp swoftcli.phar create:app --type ws Swoft-WebSocket\nphp swoftcli.phar create:app --type tcp Swoft-TCP\n\n# \u4f7f\u7528\ncp swoftcli.phar /usr/local/bin/swoftcli && chmod a+x swoftcli\n")),(0,a.kt)("h3",{id:"3\u76ee\u5f55\u7ed3\u6784"},"3.\u76ee\u5f55\u7ed3\u6784"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\u251c\u2500\u2500 app/    ----- \u5e94\u7528\u4ee3\u7801\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 Annotation/        ----- \u5b9a\u4e49\u6ce8\u89e3\u76f8\u5173   (`ReflectionCalss`)\n\u2502   \u251c\u2500\u2500 Aspect/            ----- AOP \u5207\u9762      (`Aspect-oriented programming`)\n\u2502   \u251c\u2500\u2500 Common/            ----- \u4e00\u4e9b\u5177\u6709\u72ec\u7acb\u529f\u80fd\u7684 class bean\n\u2502   \u251c\u2500\u2500 Console/           ----- \u547d\u4ee4\u884c\u4ee3\u7801\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 Exception/         ----- \u5b9a\u4e49\u5f02\u5e38\u7c7b\u76ee\u5f55\n\u2502   \u2502   \u2514\u2500\u2500 Handler/           ----- \u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u7c7b\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 Http/              ----- HTTP \u670d\u52a1\u4ee3\u7801\u76ee\u5f55\n\u2502   \u2502   \u251c\u2500\u2500 Controller/\n\u2502   \u2502   \u2514\u2500\u2500 Middleware/\n\u2502   \u251c\u2500\u2500 Helper/            ----- \u52a9\u624b\u51fd\u6570\n\u2502   \u251c\u2500\u2500 Listener/          ----- \u4e8b\u4ef6\u76d1\u542c\u5668\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 Model/             ----- \u6a21\u578b\u3001\u903b\u8f91\u7b49\u4ee3\u7801\u76ee\u5f55(\u8fd9\u4e9b\u5c42\u5e76\u4e0d\u9650\u5b9a\uff0c\u6839\u636e\u9700\u8981\u4f7f\u7528)\n\u2502   \u2502   \u251c\u2500\u2500 Dao/\n\u2502   \u2502   \u251c\u2500\u2500 Data/\n\u2502   \u2502   \u251c\u2500\u2500 Logic/\n\u2502   \u2502   \u2514\u2500\u2500 Entity/\n\u2502   \u251c\u2500\u2500 Rpc/               ----- RPC \u670d\u52a1\u4ee3\u7801\u76ee\u5f55\n\u2502   \u2502   \u2514\u2500\u2500 Service/\n\u2502   \u2502   \u2514\u2500\u2500 Middleware/\n\u2502   \u251c\u2500\u2500 WebSocket/         ----- WebSocket \u670d\u52a1\u4ee3\u7801\u76ee\u5f55\n\u2502   \u2502   \u251c\u2500\u2500 Chat/\n\u2502   \u2502   \u251c\u2500\u2500 Middleware/\n\u2502   \u2502   \u2514\u2500\u2500 ChatModule.php\n\u2502   \u251c\u2500\u2500 Tcp/               ----- TCP \u670d\u52a1\u4ee3\u7801\u76ee\u5f55\n\u2502   \u2502   \u2514\u2500\u2500 Controller/        ----- TCP \u670d\u52a1\u5904\u7406\u63a7\u5236\u5668\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 Application.php    ----- \u5e94\u7528\u7c7b\u6587\u4ef6\u7ee7\u627f\u81easwoft\u6838\u5fc3\n\u2502   \u251c\u2500\u2500 AutoLoader.php     ----- \u9879\u76ee\u626b\u63cf\u7b49\u4fe1\u606f(\u5e94\u7528\u672c\u8eab\u4e5f\u7b97\u662f\u4e00\u4e2a\u7ec4\u4ef6)\n\u2502   \u2514\u2500\u2500 bean.php\n\u251c\u2500\u2500 bin/\n\u2502   \u251c\u2500\u2500 bootstrap.php\n\u2502   \u2514\u2500\u2500 swoft              ----- Swoft \u5165\u53e3\u6587\u4ef6\n\u251c\u2500\u2500 config/                ----- \u5e94\u7528\u914d\u7f6e\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 base.php               ----- \u57fa\u7840\u914d\u7f6e\n\u2502   \u2514\u2500\u2500 db.php                 ----- \u6570\u636e\u5e93\u914d\u7f6e\n\u251c\u2500\u2500 public/                ----- \u516c\u5171\u76ee\u5f55\n\u251c\u2500\u2500 resource/              ----- \u5e94\u7528\u8d44\u6e90\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 language/              ----- \u8bed\u8a00\u8d44\u6e90\u76ee\u5f55  \n\u2502   \u2514\u2500\u2500 view/                  ----- \u89c6\u56fe\u8d44\u6e90\u76ee\u5f55  \n\u251c\u2500\u2500 runtime/               ----- \u4e34\u65f6\u6587\u4ef6\u76ee\u5f55\uff08\u65e5\u5fd7\u3001\u4e0a\u4f20\u6587\u4ef6\u3001\u6587\u4ef6\u7f13\u5b58\u7b49\uff09\n\u251c\u2500\u2500 test/                  ----- \u5355\u5143\u6d4b\u8bd5\u76ee\u5f55\n\u2502   \u2514\u2500\u2500 bootstrap.php\n\u251c\u2500\u2500 composer.json\n\u251c\u2500\u2500 phar.build.inc\n\u2514\u2500\u2500 phpunit.xml.dist\n")),(0,a.kt)("h3",{id:"4\u8fd0\u884c\u670d\u52a1"},"4.\u8fd0\u884c\u670d\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"\u5982\u679c\u5728 .env \u6587\u4ef6\u4e2d\u5f00\u542f\u4e86\u8c03\u8bd5 SWOFT_DEBUG=1 \u5c06\u4f1a\u5728\u63a7\u5236\u53f0\u4e2d\u663e\u793a\u66f4\u591a\u8be6\u7ec6\u7684\u4fe1\u606f\u3002\n")),(0,a.kt)("h4",{id:"1http-server-1"},"1.http server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u542f\u52a8 HTTP \u670d\u52a1\n$ php ./bin/swoft http:start\n\n# \u4ee5\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u542f\u52a8\n$ php ./bin/swoft http:start -d\n\n# \u91cd\u542f HTTP \u670d\u52a1\n$ php ./bin/swoft http:restart\n\n# \u91cd\u65b0\u52a0\u8f7d HTTP \u670d\u52a1\n$ php ./bin/swoft http:reload\n\n# \u505c\u6b62 HTTP \u670d\u52a1\n$ php ./bin/swoft http:stop\n\n# swoftcli\nswoftcli -h\nswoftcli run -c ws:start\nswoftcli run -c http:start\n")),(0,a.kt)("h4",{id:"2websocket-server-1"},"2.websocket server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u542f\u52a8 WS \u670d\u52a1\n$ php ./bin/swoft ws:start\n\n# \u4ee5\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u542f\u52a8\n$ php ./bin/swoft ws:start -d\n\n# \u91cd\u542f WS \u670d\u52a1\n$ php ./bin/swoft ws:restart\n\n# \u91cd\u65b0\u52a0\u8f7d WS \u670d\u52a1\n$ php ./bin/swoft ws:reload\n\n# \u5173\u95ed WS \u670d\u52a1\n$ php ./bin/swoft ws:stop\n")),(0,a.kt)("h4",{id:"3rpc-server"},"3.rpc server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u542f\u52a8 RPC \u670d\u52a1\n$ php ./bin/swoft rpc:start\n\n# \u4ee5\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u542f\u52a8\n$ php ./bin/swoft rpc:start -d\n\n# \u91cd\u542f RPC \u670d\u52a1\n$ php ./bin/swoft rpc:restart\n\n# \u91cd\u65b0\u52a0\u8f7d RPC \u670d\u52a1\n$ php ./bin/swoft rpc:reload\n\n# \u5173\u95ed RPC \u670d\u52a1\n$ php ./bin/swoft rpc:stop\n")),(0,a.kt)("h3",{id:"5\u6ce8\u89e3"},"5.\u6ce8\u89e3"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},'use Swoft\\Http\\Message\\Request;\nuse Swoft\\Http\\Server\\Annotation\\Mapping\\Controller;\nuse Swoft\\Http\\Server\\Annotation\\Mapping\\RequestMapping;\n\n/**\n * Class Home\n *\n * @Controller(prefix="home")\n */\nclass Home\n{\n    /**\n     * \u8be5\u65b9\u6cd5\u8def\u7531\u5730\u5740\u4e3a /home/index\n     *\n     * @RequestMapping(route="/index", method="post")\n     *\n     * @param Request $request\n     */\n    public function index(Request $request)\n    {\n        // TODO:\n    }\n}\n')),(0,a.kt)("h3",{id:"6ioc---di"},"6.IoC - DI"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"IoC: Inversion of Control\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"DI: Dependency Injection\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Bean\u5bb9\u5668")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u5b9a\u4e49\n@Bean\n\u547d\u540d\u7a7a\u95f4\uff1a\\Swoft\\Bean\\Annotation\\Bean\n\nname \u5b9a\u4e49 Bean \u522b\u540d\uff0c\u7f3a\u7701\u9ed8\u8ba4\u7c7b\u540d\nscope \u6ce8\u5165 Bean \u7c7b\u578b\uff0c\u9ed8\u8ba4\u5355\u4f8b\uff0cScope::SINGLETON/Scope::PROTOTYPE(\u6bcf\u6b21\u521b\u5efa)\nref \u6307\u5b9a\u5f15\u7528 Bean \uff0c\u7528\u4e8e\u5b9a\u4e49\u5728\u63a5\u53e3\u4e0a\u9762\uff0c\u6307\u5b9a\u4f7f\u7528\u54ea\u4e2a\u63a5\u53e3\u5b9e\u73b0\u3002\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u6ce8\u5165\n@Inject\n\u547d\u540d\u7a7a\u95f4\uff1a\\Swoft\\Bean\\Annotation\\Inject\n\nname \u5b9a\u4e49\u5c5e\u6027\u6ce8\u5165\u7684bean\u540d\u79f0\uff0c\u7f3a\u7701\u5c5e\u6027\u81ea\u52a8\u7c7b\u578b\u540d\u79f0\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"# \u64cd\u4f5c\nApp::getBean(\"name\");\nApplicationContext::getBean('name');\nBeanFactory::getBean('name');\nBeanFactory::hasBean(\"name\");\n")))}k.isMDXComponent=!0},6488:function(e,n,t){n.Z=t.p+"assets/images/image-20200415173221790-61efc04913f5a5f158ba5cab30ce8d33.png"},1709:function(e,n,t){n.Z=t.p+"assets/images/image-20200415174047471-98428b01264e2fd92038a1175aa003eb.png"},485:function(e,n,t){n.Z=t.p+"assets/images/image-20200417173904872-a5a221aecea7659c6d93da4b581c2c90.png"},4844:function(e,n,t){n.Z=t.p+"assets/images/image-20200417173929936-68a1b530933812347193d6a2af7fbcaa.png"}}]);